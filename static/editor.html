<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Tour Editor</title>
    <link rel="stylesheet" href="/static/css/editor.css">
</head>

<body>
    <div class="editor-container">
        <!-- Side Panel -->
        <div class="side-panel">
            <div class="panel-header">
                <div class="panel-title" id="tour-title">Virtual Tour Editor</div>
                <div class="panel-subtitle" id="tour-subtitle">Loading tour...</div>
                <button class="home-btn" onclick="returnToHomepage()" title="Return to Homepage">
                    üè† Homepage
                </button>
            </div>

            <div class="panel-content">
                <!-- Toolbar Section -->
                <div class="toolbar-section">
                    <button class="toolbar-btn primary" onclick="showAddSceneModal()">
                        ‚ûï Add Scenes
                    </button>
                    <div class="toolbar-row">
                        <button class="toolbar-btn secondary" onclick="fastRename()">
                            ‚úèÔ∏è Fast Rename
                        </button>
                        <button class="toolbar-btn secondary" onclick="sortScenes()">
                            üí≤ Sort Scenes
                        </button>
                    </div>
                </div>

                <!-- Scene Gallery -->
                <div class="scene-gallery" id="scene-gallery">
                    <!-- Scene items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Main Viewer -->
        <div class="main-viewer">
            <canvas id="viewer-canvas"></canvas>
            
            <!-- Top Toolbar -->
            <div class="top-toolbar">
                <div class="toolbar-left">
                    <div class="tour-title" id="current-scene-name">Loading...</div>
                    <div class="tour-info" id="tour-info">Preparing virtual tour editor</div>
                </div>
                <div class="toolbar-right">
                    <button class="btn small" onclick="resetView()">üéØ</button>
                    <button class="btn small" onclick="toggleFullscreen()">‚õ∂</button>
                </div>
            </div>

            <!-- Bottom Toolbar -->
            <div class="bottom-toolbar">
                <button class="toolbar-btn" onclick="addInfospot()">üìç Add Infospot</button>
                <button class="toolbar-btn" id="link-hotspot-btn" onclick="toggleHotspotMode()">üîó Link Hotspot</button>
                <button class="toolbar-btn" onclick="setInitialView()">üëÅÔ∏è Set Initial View</button>
                <button class="toolbar-btn" onclick="previewTour()">‚ñ∂Ô∏è Preview</button>
            </div>

            <!-- Hotspot Creation Mode Indicator -->
            <div class="hotspot-creation-mode" id="hotspot-mode" style="display: none;">
                Click on the panorama to create a connection hotspot
            </div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading-indicator">
                <div class="spinner"></div>
                <div>Loading virtual tour...</div>
            </div>
        </div>
    </div>

    <!-- Add Scene Modal -->
    <div id="add-scene-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Scene</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="scene-name">Scene Name:</label>
                    <input type="text" id="scene-name" class="form-input" placeholder="Enter scene name" />
                </div>
                
                <!-- File Upload Area -->
                <div class="form-group">
                    <label class="form-label">Upload New 360¬∞ Image:</label>
                    <div class="upload-area" onclick="document.getElementById('file-upload').click()">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Click to upload or drag & drop</div>
                        <div class="upload-hint">Supports JPG, PNG files (Equirectangular format)</div>
                    </div>
                    <input type="file" id="file-upload" class="file-input" accept="image/*" />
                </div>

                <div class="form-group">
                    <label class="form-label">Or select from existing 360¬∞ images:</label>
                    <div class="asset-grid" id="asset-grid">
                        <!-- Asset items will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeAddSceneModal()">Cancel</button>
                <button class="btn success" onclick="confirmAddScene()">Add Scene</button>
            </div>
        </div>
    </div>

    <!-- Add Connection Modal -->
    <div id="add-connection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Connection</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="target-scene">Target Scene:</label>
                    <select id="target-scene" class="form-input">
                        <option value="">Select target scene...</option>
                    </select>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeAddConnectionModal()">Cancel</button>
                <button class="btn success" onclick="confirmAddConnection()">Create Connection</button>
            </div>
        </div>
    </div>

    <!-- Include Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="/static/js/app-base.js"></script>
    <script src="/static/js/editor.js"></script>
</body>

</html>
