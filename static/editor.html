<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Tour Editor</title>
    <link rel="stylesheet" href="/static/css/editor.css">
</head>

<body>
    <div class="editor-container">
        <!-- Side Panel -->
        <div class="side-panel">
            <div class="panel-header">
                <div class="panel-title" id="tour-title">Virtual Tour Editor</div>
                <div class="panel-subtitle" id="tour-subtitle">Loading tour...</div>
                <button class="home-btn" onclick="returnToHomepage()" title="Return to Homepage">
                    üè† Homepage
                </button>
            </div>

            <div class="panel-content">
                <!-- Toolbar Section -->
                <div class="toolbar-section">
                    <button class="toolbar-btn primary" onclick="showAddSceneModal()">
                        ‚ûï Add Scenes
                    </button>
                    <div class="toolbar-row">
                        <button class="toolbar-btn secondary" onclick="sortScenes()">
                            ‚áµ Sort Scenes
                        </button>
                    </div>
                </div>

                <!-- Scene Gallery -->
                <div class="scene-gallery" id="scene-gallery">
                    <!-- Scene items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Main Viewer -->
        <div class="main-viewer">
            <canvas id="viewer-canvas"></canvas>
            
            <!-- Top Toolbar -->
            <div class="top-toolbar">
                <div class="toolbar-left">
                    <div class="tour-title" id="current-scene-name">Loading...</div>
                    <div class="tour-info" id="tour-info">Preparing virtual tour editor</div>
                </div>
                <div class="toolbar-right">
                    <button class="btn icon-btn" onclick="resetView()" title="Reset View">
                        <img src="/static/assets/reset_icon.png" alt="Reset" class="icon-img" />
                        <span class="btn-text">Reset View</span>
                    </button>
                    <button class="btn icon-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
                        <img src="/static/assets/fullscreen_icon.png" alt="Fullscreen" class="icon-img" />
                        <span class="btn-text">Toggle Fullscreen</span>
                    </button>
                </div>
            </div>

            <!-- Bottom Toolbar -->
            <div class="bottom-toolbar">
                <button class="toolbar-btn" onclick="addInfospot()">Add Infospot</button>
                <button class="toolbar-btn" id="link-hotspot-btn" onclick="toggleHotspotMode()">Link Hotspot</button>
                <button class="toolbar-btn" onclick="setInitialView()">Set Initial View</button>
            </div>

            <!-- Hotspot Creation Mode Indicator -->
            <div class="hotspot-creation-mode" id="hotspot-mode" style="display: none;">
                Click on the panorama to create a connection hotspot
            </div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading-indicator">
                <div class="spinner"></div>
                <div class="loading-message">Loading virtual tour...</div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container">
        <!-- Notifications will be dynamically added here -->
    </div>

    <!-- Add Scene Modal -->
    <div id="add-scene-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Scene(s)</div>
            </div>
            <div class="modal-body">
                <!-- File Upload Area -->
                <div class="form-group">
                    <label class="form-label">Upload 360¬∞ Image(s):</label>
                    <div class="upload-area" onclick="document.getElementById('file-upload').click()">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Click to upload or drag & drop</div>
                        <div class="upload-hint">Supports JPG, PNG files (Equirectangular format)</div>
                    </div>
                    <input type="file" id="file-upload" class="file-input" accept="image/*" multiple />
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeAddSceneModal()">Cancel</button>
                <button class="btn success" onclick="confirmAddScene()">Add Scene(s)</button>
            </div>
        </div>
    </div>

    <!-- Add Connection Modal -->
    <div id="add-connection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Connection</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="target-scene">Target Scene:</label>
                    <select id="target-scene" class="form-input">
                        <option value="">Select target scene...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="connection-name">Display Name (optional):</label>
                    <input id="connection-name" class="form-input" placeholder="e.g. To Lobby" />
                    <div class="form-hint">Shown on hover over the connection.</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeAddConnectionModal()">Cancel</button>
                <button class="btn success" onclick="confirmAddConnection()">Create Connection</button>
            </div>
        </div>
    </div>

    <!-- Edit Connection Modal -->
    <div id="edit-connection-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Connection</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="edit-target-scene">Target Scene:</label>
                    <select id="edit-target-scene" class="form-input">
                        <option value="">Select target scene...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-connection-name">Display Name (optional):</label>
                    <input id="edit-connection-name" class="form-input" placeholder="e.g. Lobby ‚Üí Hatches" />
                    <div class="form-hint">Shown on hover over the connection.</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeEditConnectionModal()">Cancel</button>
                <button class="btn danger" onclick="deleteActiveConnection()">Delete</button>
                <button class="btn success" onclick="confirmEditConnection()">Save</button>
            </div>
        </div>
    </div>

    <!-- Add Closeup Modal -->
    <div id="add-closeup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Closeup</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="closeup-name">Title (optional):</label>
                    <input id="closeup-name" class="form-input" placeholder="e.g. Panel Label" />
                </div>
                <div class="form-group">
                    <label class="form-label">Icon:</label>
                    <div class="inline-options">
                        <label><input type="radio" name="closeup-icon" value="1" checked /> <img src="/static/assets/info1_icon.png" class="icon-img" /></label>
                        <label><input type="radio" name="closeup-icon" value="2" /> <img src="/static/assets/info2_icon.png" class="icon-img" /></label>
                        <label><input type="radio" name="closeup-icon" value="3" /> <img src="/static/assets/info3_icon.png" class="icon-img" /></label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="closeup-file">Optional image file (opens on Ctrl+Click):</label>
                    <div class="upload-area closeup-upload-area" onclick="document.getElementById('closeup-file').click()">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">Click to upload or drag & drop</div>
                        <div class="upload-hint">JPG or PNG, up to ~100MB</div>
                    </div>
                    <input type="file" id="closeup-file" class="file-input" accept="image/*" />
                </div>
                <div class="form-group">
                    
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="if (editor) editor.closeAddCloseupModal()">Cancel</button>
                <button class="btn success" onclick="if (editor) editor.confirmAddCloseup()">Create Closeup</button>
            </div>
        </div>
    </div>

    <!-- Edit Closeup Modal -->
    <div id="edit-closeup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Closeup</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="edit-closeup-name">Title (optional):</label>
                    <input id="edit-closeup-name" class="form-input" placeholder="Closeup title" />
                </div>
                <div class="form-group">
                    <label class="form-label">Icon:</label>
                    <div class="inline-options">
                        <label><input type="radio" name="edit-closeup-icon" value="1" /> <img src="/static/assets/info1_icon.png" class="icon-img" /></label>
                        <label><input type="radio" name="edit-closeup-icon" value="2" /> <img src="/static/assets/info2_icon.png" class="icon-img" /></label>
                        <label><input type="radio" name="edit-closeup-icon" value="3" /> <img src="/static/assets/info3_icon.png" class="icon-img" /></label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-closeup-file">Replace image (optional):</label>
                    <div class="upload-area edit-closeup-upload-area" onclick="document.getElementById('edit-closeup-file').click()">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">Click to upload or drag & drop</div>
                        <div class="upload-hint">JPG or PNG, up to ~100MB</div>
                    </div>
                    <input type="file" id="edit-closeup-file" class="file-input" accept="image/*" />
                </div>
                <div class="form-group">
                    
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="if (editor) editor.closeEditCloseupModal()">Cancel</button>
                <button class="btn danger" onclick="deleteActiveCloseup()">Delete</button>
                <button class="btn success" onclick="if (editor) editor.confirmEditCloseup()">Save</button>
            </div>
        </div>
    </div>

    <!-- Include Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="/static/js/app-base.js"></script>
    <script src="/static/js/editor.js"></script>

    <!-- Image Viewer Modal for Closeups -->
    <div id="image-viewer" class="image-viewer" style="display:none;">
        <div class="image-viewer-backdrop"></div>
        <div class="image-viewer-content">
            <button class="image-viewer-close" title="Close">√ó</button>
            <img id="image-viewer-img" alt="Closeup" />
        </div>
    </div>
</body>

</html>
